# QA

QAチームに所属して、自社サービスのQAに従事した。

---

## 自社サービスのサーバ/クライアントのQA

自社が提供するサービスのサーバ(多くはREST API)およびクライアント(サーバへのアクセスを抽象化したSDK)のQAを行った。

### 背景

自社が提供する(していた)サービスの例を以下に示す。
小型デバイス内の情報をサーバに上げ管理する、といった傾向のサービスを提供しており、対象となるデバイスが変化する毎にサービスをリニューアルしてきた。

- 携帯(ガラケー) バックエンドサービス
- モバイル(スマホ) バックエンドサービス(mBaaS)
- IoT バックエンドサービス

以下のような構成で概ね統一されている。

- メインとなる機能を提供するREST APIサーバ
- 補助機能を提供するAPIサーバ
   - RESTでない場合がある
   - HTTPベースのプロトコルでない場合もある
- クライアントSDK
   - メインサーバへのアクセスを各プラットフォームに合った形で抽象化する。
- WebUI
   - メインサーバに格納している情報にブラウザからアクセスする。

このうち、『メインのREST APIサーバ』および『クライアントSDK』のQAを主に担当した。

### 技術スタックと選定理由

- サーバテスト
   - Java
      - 入社当初からテストの実装言語に使われており、それを引き継いだ。
   - Groovy
      - Javaの後継の実装言語として採用した。
   - Python
      - 現在のメインの実装言語
      - 完全にGroovyを置きかえることはしていない
- クライアントテスト
   - Java
      - Android用SDKのテストの実装言語
      - Kotlin が普及した頃にはSDKの開発が下火になっており、テストもそれに合わせる形で保守フェイズに移っていた。そのため、Kotlinへの移行は経験していない。
   - Objective-C
      - iOS用SDKのテストの実装言語
      - Swift が普及した頃にはSDKの開発が下火になっており、テストもそれに合わせる形で保守フェイズに移っていた。そのため、Swiftへの移行は経験していない。
   - JavaScript
      - Web用SDKのテストの実装言語
      - ES6 以降の対応は、Promiseの対応以外は行われなかった。
   - C#
      - Unity用SDKのテストの実装言語
- Jenkins
   - CI環境として使用
   - 更新が停滞しているプラグインが目立つなどレガシー化してきているのも事実だが、未だにこれと同等の情報を提供するViewがないため継続して使用している。
      - View以外の機能は徐々に引き剥がしを進めている。
         - ジョブワークフロー
         - ワーカー管理: [取り組み](./infra.md#kubernetes上でのテスト実行202011検証中)

### もたらした改善/成果

- JavaからGroovyへの移行
   - テストの実装言語にスクリプト言語のような柔軟性を取り入れる事を目的に採用し、移行を主導した。
      - テストの実装では基本的に入力を全て制御できるので、堅牢性よりも柔軟性を優先したい場合が多かった。
      - とはいえ、今あるJavaの資産を全て捨てるのも非現実的であり、JVMの上で動く言語からJavaと親和性が高い言語を選択することになった。
      - Java => Groovy/Groovy => Javaの呼び出しが簡単に行えるだけでなく、完全にGroovyへの移行を検討(後に実施)した場合もファイルの拡張子を変更するだけで大部分が対応できることが分かり、他の言語よりも親和性の観点で抜きん出ていると判断した。
   - この移行がある程度進行した段階で、AndroidのKotlin採用が決定した。Kotlinを採用していればAndroidのテストの移行も同様に進んでいた可能性があり、ややタイミングが悪かったと言える。
- Pythonの導入
   - 新しいサービスのテストプロジェクトであったため、既存の資産の活用を考える意味は薄かった。
   - Java => Groovyの移行を通して、テストの実装言語として柔軟性に重きを置いた方針は継続しても問題ないというある程度の確信を得ていた。
   - [機能レベルでのチェックツール](./for_company.md#機能レベルでのチェックツール201311)を作った経験から、Python(pytest)はテストの実装手段としての柔軟性を備えていることを把握していた。
   - Java/Groovyと比較するとPythonはデフォルトでインストールされている場合が多く、チーム外の人間でも比較的簡単にテストを実行できるのではないかと考えた。
- 自身のスキル向上
   - [テストに必要なインフラの構築](./infra.md)について担当者が決まっていなかったため、個人プロジェクトからスタートしてチームの状況を改善した。
   - テストに関する重要な基礎を得た
      - 破壊的なテストケースを作成する際の観点
      - 再現テストの作成のコツ

### 残った/生じた課題

- WebUIのテスト
   - WebUIの品質に関しては、開発者の作成するテストに依存した状況が続いている
   - チームで何回かWebUIのテストスイートの作成を試みたが、変更の頻度とテストの脆さの間に妥協点を見出せていない
